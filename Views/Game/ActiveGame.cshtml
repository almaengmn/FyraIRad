@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    var gameId = ViewBag.GameId;
    var MoveList = ViewBag.MoveList as List<MoveDetails>;
}
@ViewBag.MoveError
<div class="mt-3 d-flex justify-content-center gap-3">
    <div class="btn btn-outline-danger btn-sm">
        🔴 Röd spelare: <strong>@ViewBag.RedPlayerName</strong>
        @if (ViewBag.CurrentTurn == 'R')
        {
            <span class="badge bg-light text-dark ms-2">Tur</span>
        }
    </div>

    <div class="btn btn-outline-warning btn-sm text-dark">
        🟡 Gul spelare: <strong>@ViewBag.YellowPlayerName</strong>
        @if (ViewBag.CurrentTurn == 'Y')
        {
            <span class="badge bg-dark text-light ms-2">Tur</span>
        }
    </div>
</div>


@if(ViewBag.GameStatus == "Finished")
{
    <div class="mt-3 d-flex justify-content-center">
        <div class="alert alert-success" role="alert">
            🎉 Spelet är över! Vinnaren är: <strong>
                @if(ViewBag.Winner == 'R')
                {
                    @ViewBag.RedPlayerName
                }
                else if(ViewBag.Winner == 'Y')
                {
                    @ViewBag.YellowPlayerName
                }
            </strong>
        </div>
        <form asp-action="DeleteGame" asp-controller="Game" method="post" class="mt-3 text-center">
            <input type="hidden" name="gameId" value="@ViewBag.GameId" />
            <button type="submit" class="btn btn-outline-danger btn-sm">
                End Game
            </button>
        </form>
    </div>
}
else if (ViewBag.GameStatus == "Surrender")
{
    <div class="mt-3 d-flex justify-content-center">
        <div class="alert alert-warning" role="alert">
            ⚠️ Spelet är över! Spelaren <strong>
                @if(ViewBag.Winner == 'R')
                {
                    @ViewBag.RedPlayerName
                }
                else if(ViewBag.Winner == 'Y')
                {
                    @ViewBag.YellowPlayerName
                }
            </strong> vann eftersom motståndaren gav upp.
        </div>
        
        <form asp-action="DeleteGame" asp-controller="Game" method="post" class="mt-3 text-center">
            <input type="hidden" name="gameId" value="@ViewBag.GameId" />
            <button type="submit" class="btn btn-outline-danger btn-sm">
                End Game
            </button>
        </form>
    </div>

}
else if(ViewBag.GameStatus == "Draw")
{
    <div class="mt-3 d-flex justify-content-center">
        <div class="alert alert-info" role="alert">
            🤝 Spelet är över! Det blev oavgjort mellan <strong>@ViewBag.RedPlayerName</strong> och <strong>@ViewBag.YellowPlayerName</strong>.
        </div>
        
        <form asp-action="DeleteGame" asp-controller="Game" method="post" class="mt-3 text-center">
            <input type="hidden" name="gameId" value="@ViewBag.GameId" />
            <button type="submit" class="btn btn-outline-danger btn-sm">
                End Game
            </button>
        </form>
    </div>
}
else
{
    <!-- Pilar ovanför rutnätet -->
    <div style="width: 750px; display: grid; grid-template-columns: repeat(7, 100px); gap: 5px; margin-bottom: 5px;">
        @for (int column = 1; column < 8; column++)
        {
            <div style="display: flex; justify-content: center;">
                <form asp-action="CreateMove" asp-controller="Game" method="post" style="margin:0;">
                    <input type="hidden" name="gameId" value="@gameId" />
                    <input type="hidden" name="column" value="@column" />
                    <button type="submit" style="background:none; border:none; cursor:pointer;">
                        <span style="font-size:2em;">&#8595;</span> <!-- Nedåtpil -->
                    </button>
                </form>
            </div>
        }
    </div>
}


<!-- Rutnätet -->
<div style="width: 750px; display: grid; grid-template-columns: repeat(7, 100px); grid-template-rows: repeat(6, 100px); gap: 5px; border: 2px solid black; padding: 10px; background-color: #f0f0f0;">
    @for (int row = 1; row < 7; row++)
    {
        for (int col = 1; col < 8; col++)
        {
            <div style="width: 100px; height: 100px; background-color: #ffffff; border: 1px solid #000000; display: flex; align-items: center; justify-content: center;">
                @for(int listPos = 0; listPos < MoveList.Count(); listPos++){

                    if(MoveList[listPos].RowIndex == row && MoveList[listPos].ColumnIndex == col){
                        if(MoveList[listPos].DiscColor == 'R'){
                            <div style="width: 80px; height: 80px; background-color: red; border-radius: 50%;"></div>
                        } else if(MoveList[listPos].DiscColor == 'Y' ){
                            <div style="width: 80px; height: 80px; background-color: yellow; border-radius: 50%;"></div>
                        }
                    }

                }
            </div>
        }
    }
</div>

@if (ViewBag.GameStatus == "Active")
{
    <form asp-action="SurrenderGame" asp-controller="Game" method="post" class="mt-3 text-center">
        <input type="hidden" name="gameId" value="@ViewBag.GameId" />
        <button type="submit" class="btn btn-outline-danger btn-sm">
            🛑 Surrender
        </button>
    </form>
}